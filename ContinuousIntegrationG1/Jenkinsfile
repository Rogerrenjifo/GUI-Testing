pipeline {
    agent any
    environment {
        PYTHONPATH = "${WORKSPACE}"
        REPO_NAME = "${GIT_URL.split('/')[-2]}/${GIT_URL.split('/')[-1].replace('.git', '')}"
        PASSWORD=credentials('user')
        USER=credentials('password')
        BROWSER="remote_chrome"
        DEVICE="pc"
        IMPLICIT_TIMEOUT="30"
    }
    stages {          
        stage('Build Browser Environments') {    
            steps {
                bat 'docker run -d -p 4444:4444 --net docker_default --name chrome -p 7900:7900 --shm-size="2g" selenium/standalone-chrome:latest'
            }
        }
        stage('Instalar dependencias') {
            steps {
                script {
                        bat "python -m venv ${virtualenvDir}"  // Crear el entorno virtual
                    virtualenvDir = "${WORKSPACE}\\venv"  // Directorio del entorno virtual
                        bat ".\\venv\\Scripts\\activate"
                        bat "${virtualenvDir}\\Scripts\\pip install -r ${WORKSPACE}\\requeriments.txt"  // Instalar las dependencias en el entorno virtual
                }
            }
        }                                                          
        stage('Run Test Cases'){
            steps {
                bat '.\\venv\\Scripts\\robot  --outputdir .\\Blueprint\\Reports -i TAB_ELEMENTS .\\Blueprint\\TestCases'
            }
            post {
                always {
                    archiveArtifacts artifacts: 'Bluprint/Reports/', fingerprint: true
                }
            }
        }
        stage('Down Browser Environments') {    
            steps {
                bat 'docker container ls'
            }
        }
    }
    post{
        always{
            bat 'docker container stop chrome'
            bat 'docker container rm chrome'
        }
    }
}
